<!doctype html>
<html lang="en" data-bs-theme="auto">

<head>
  <%- include('../partials/head-meta') %>
    <link rel="stylesheet" href="/css/index.css" />
    <link rel="stylesheet" href="/css/tooltips.css" />

    <script src="/js/theme.js" defer></script>
    <script src="/js/tooltips.js" defer></script>
    <script src="/vendor/bootstrap/bootstrap.min.js" defer></script>
    <script src="/vendor/qr-code-styling/qr-code-styling.js" defer></script>
    <script type="module" src="/js/page-common.js"></script>
    <script type="module" src="/js/webui-main.js"></script>
</head>

<body>
  <main>
    <div class="container-main">
      <%- include('../partials/header') %>
        <p id="tagline" class="lead text-center mb-4">Send a file securely, or enter a sharing code to receive one.</p>

        <div id="statusAlert" class="alert mt-3" role="status" hidden></div>

        <div id="panels" class="row g-4">
          <!-- File selection -->
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-body p-4">
                <div id="dropzone" class="dropzone text-center" tabindex="0" role="button" aria-label="Select a file">
                  <h5 class="mb-2">Drag &amp; Drop File Here</h5>
                  <div class="text-body-secondary mb-3">or</div>
                  <button class="btn btn-secondary" id="selectFileBtn" type="button">Select File</button>
                  <input id="fileInput" class="visually-hidden" type="file" />

                  <div id="fileChosen" class="mt-3 small text-body-secondary" hidden>
                    <span class="fw-semibold" id="fileChosenName">file</span>
                    <span class="mx-1">â€¢</span>
                    <span id="fileChosenSize">0 MB</span>
                  </div>

                  <div class="mt-4 small text-body-secondary" id="maxUploadHint">Loading server limits...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Options -->
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-body p-4">
                <div class="text-center">
                  <h2 class="h4 fw-semibold mb-1">Options</h2>
                  <div class="text-body-secondary">Choose how to upload your file.</div>
                </div>

                <hr class="my-4" />

                <div class="mb-3" id="optUploadMode">
                  <div class="d-flex align-items-center justify-content-between">
                    <div class="form-label fw-semibold mb-1">Upload Mode</div>
                    <button type="button" class="help-btn"
                      style="background: none; border: none; cursor: help; color: var(--bs-secondary-color);"
                      data-tooltip='"Standard" will return a link to share your file. "Direct Transfer" uses peer-to-peer; you must keep this page open while sending.'
                      aria-label="Upload mode help"><span class="material-icons-round">help</span></button>
                  </div>
                  <div class="btn-group w-100" role="group" aria-label="Upload mode">
                    <button class="btn btn-outline-primary active" id="modeStandard" type="button"
                      aria-selected="true">Standard</button>
                    <button class="btn btn-outline-primary" id="modeP2P" type="button" aria-selected="false">Direct
                      Transfer</button>
                  </div>
                </div>

                <div id="optLifetime" class="mb-3">
                  <div class="form-label fw-semibold mb-1">File Lifetime</div>
                  <div class="input-group">
                    <input id="lifetimeValue" class="form-control" type="number" min="0" step="0.5" value="24" />
                    <select id="lifetimeUnit" class="form-select" aria-label="Lifetime unit" style="max-width: 9rem;">
                      <option value="minutes">Minutes</option>
                      <option value="hours" selected>Hours</option>
                      <option value="days">Days</option>
                      <option value="unlimited">Unlimited</option>
                    </select>
                  </div>
                  <div class="form-text" id="lifetimeHelp">Loading...</div>
                </div>

                <div id="securityStatus" class="security-status-card mb-3">
                  <div class="d-flex align-items-center gap-2">
                    <span class="material-icons-round" id="securityIcon">https</span>
                    <span id="securityText">Checking security...</span>
                  </div>
                </div>

                <div id="p2pInfo" class="alert alert-secondary small py-2" hidden>
                  You&#39;ll get a code to share with the recipient.<br />
                  You must keep this page open to complete the transfer.
                </div>

                <button class="btn btn-primary w-100" id="startBtn" type="button">Start Upload</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Progress cards -->
        <div id="progressCard" class="card shadow-sm mt-4 border border-primary" hidden>
          <div class="card-body p-4 text-center">
            <div id="progressIcon" class="text-primary mb-2"><span class="material-icons-round">upload</span></div>
            <h5 class="mb-1" id="progressTitle">Uploading</h5>
            <div class="text-body-secondary" id="progressSub">Preparing...</div>
            <div class="progress mt-3" role="progressbar" style="height: 6px;">
              <div id="progressFill" class="progress-bar" style="width: 0%"></div>
            </div>
            <div class="small text-body-secondary mt-2" id="progressBytes">Starting upload...</div>
            <button class="btn btn-secondary mt-3" id="cancelStandardUpload" type="button" style="display: none;">Cancel
              Upload</button>
            <button class="btn btn-secondary mt-3" id="cancelP2PSend" type="button" style="display: none;">Cancel
              Transfer</button>
          </div>
        </div>

        <div id="p2pWaitCard" class="card shadow-sm mt-4 border border-primary" hidden>
          <div class="card-body p-4 text-center">
            <div class="text-primary mb-2"><span class="material-icons-round">wifi_tethering</span></div>
            <h5 class="mb-2">Awaiting connection...</h5>
            <div class="text-body-secondary">Provide your recipient with the code below:</div>

            <div class="code-box my-3" id="p2pCode">ABCD-1234</div>

            <div class="small text-body-secondary mb-2" id="p2pLinkLabel">or share this link:</div>
            <div class="input-group">
              <input class="form-control" id="p2pLink" readonly value="" />
              <button class="btn btn-outline-secondary" id="copyP2PLink" type="button" aria-label="Copy link">
                <span class="material-icons-round">content_copy</span>
              </button>
              <button class="btn btn-outline-secondary" id="qrP2PLink" type="button" aria-label="Show QR code">
                <span class="material-icons-round">qr_code_2</span>
              </button>
            </div>

            <button class="btn btn-secondary mt-3" id="cancelP2P" type="button">Cancel</button>
          </div>
        </div>

        <div id="shareCard" class="card shadow-sm mt-4 border border-success" hidden>
          <div class="card-body p-4 text-center">
            <div class="text-success mb-2"><span class="material-icons-round">check_circle</span></div>
            <h5 class="mb-2" id="shareTitle">Upload Complete</h5>
            <div class="text-body-secondary" id="shareSub">Share this link with your recipient:</div>

            <div class="input-group mt-3" id="shareLinkGroup">
              <input class="form-control" id="shareLink" readonly value="" />
              <button class="btn btn-outline-secondary" id="copyShare" type="button" aria-label="Copy link">
                <span class="material-icons-round">content_copy</span>
              </button>
              <button class="btn btn-outline-secondary" id="qrShare" type="button" aria-label="Show QR code">
                <span class="material-icons-round">qr_code_2</span>
              </button>
            </div>

            <button class="btn btn-secondary mt-3" id="newUpload" type="button">Send another file</button>
          </div>
        </div>

        <!-- Code entry -->
        <div class="card shadow-sm mt-4" id="codeCard">
          <div class="card-body p-4">
            <div class="text-center">
              <h2 class="h5 fw-semibold mb-3">Enter Sharing Code</h2>
            </div>
            <div class="input-group">
              <input id="codeInput" class="form-control" type="text" placeholder="ABCD-1234 or file id" />
              <button id="codeGo" class="btn btn-primary" type="button" aria-label="Go">
                <span class="material-icons-round">arrow_forward</span>
              </button>
            </div>
          </div>
        </div>
    </div>
  </main>

  <!-- QR Code Modal -->
  <div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="qrModalLabel">Share via QR Code</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <div id="qrContainer" style="display:flex;align-items:center;justify-content:center;">
            <div id="qrCanvas"></div>
          </div>
          <p class="small text-body-secondary mt-3" id="qrHint">Scan with your phone to share the link.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Insecure Upload Warning Modal -->
  <div class="modal fade" id="insecureUploadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title d-flex align-items-center gap-2">
            <span class="material-icons-round text-warning">warning</span>
            Upload Security Warning
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="insecureModalBody">
          <p>This server does not support end-to-end encryption. Your file will be uploaded without encryption.</p>
          <p class="text-body-secondary small mb-0">The server administrator may be able to access your file contents.
          </p>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-warning" id="confirmInsecureUpload">Upload Anyway</button>
        </div>
      </div>
    </div>
  </div>

  <%- include('../partials/footer') %>
</body>

</html>